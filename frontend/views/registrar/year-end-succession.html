<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year-End Succession - MSEFC</title>
    <link rel="stylesheet" href="/public/components/css/sidebar-styles.css">
    <link rel="stylesheet" href="/public/components/css/page-transitions.css">
    <link rel="stylesheet" href="/public/components/css/year-end-styles.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar injected by sidebar-injector.js -->

        <main class="main-content">
            <div class="page-header">
                <h1 style="font-size: 2rem; color: #1f2937;">Year-End Section Succession</h1>
                <p style="color: #6b7280;">Manage student grade progression and returning student detection</p>
            </div>

            <div id="alertBox"></div>

            <!-- Step-by-step Process -->
            <div class="steps">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-title">Detect Returning Students</div>
                    <div class="step-description">Identify which students will return in the next school year</div>
                    <button onclick="detectReturningStudents()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Detect</button>
                    <div id="step1-status" class="step-status status-pending">Pending</div>
                </div>

                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-title">Promote Students</div>
                    <div class="step-description">Grade progression and student advancement</div>
                    <button onclick="promoteStudents()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;" disabled id="promoteBtn">Promote</button>
                    <div id="step2-status" class="step-status status-pending">Pending</div>
                </div>

                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-title">Execute Succession</div>
                    <div class="step-description">Complete year-end transition</div>
                    <button onclick="confirmExecute()" class="btn btn-danger" style="width: 100%; margin-top: 1rem;" disabled id="executeBtn">Execute</button>
                    <div id="step3-status" class="step-status status-pending">Pending</div>
                </div>
            </div>

            <!-- Section Progression Map -->
            <div class="progression-map">
                <div class="progression-title">üìä Section Progression Map</div>
                <div id="progressionContent" class="loading">Loading progression map...</div>
            </div>

            <!-- Results -->
            <div id="resultsBox" class="hidden" style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Succession Summary</h2>
                <div id="resultDetails"></div>
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal">
            <h2 class="modal-title">‚ö†Ô∏è Confirm Year-End Succession</h2>
            <div class="modal-content">
                <p>This action will:</p>
                <ul style="margin: 1rem 0 1rem 1.5rem; line-height: 1.8;">
                    <li>Promote all enrolled students to the next grade</li>
                    <li>Create new student records for next school year</li>
                    <li>Mark graduates as graduated</li>
                    <li>Update the current school year</li>
                </ul>
                <p><strong>This action cannot be undone!</strong></p>
            </div>
            <div class="modal-buttons">
                <button onclick="closeConfirmModal()" class="btn" style="background: #6b7280; color: white;">Cancel</button>
                <button onclick="executeSuccession()" class="btn btn-danger">Execute Now</button>
            </div>
        </div>
    </div>

    <script src="/public/components/js/sidebar-injector.js"></script>
    <script src="/public/components/js/shared.js"></script>
    <script src="/public/components/js/year-end.js"></script>
        
</body>
</html>
